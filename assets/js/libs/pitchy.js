!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Pitchy=r():t.Pitchy=r()}(this,(()=>(()=>{"use strict";var t={304:t=>{function r(t){if(this.size=0|t,this.size<=1||0!=(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var r=new Array(2*this.size),e=0;e<r.length;e+=2){const t=Math.PI*e/this.size;r[e]=Math.cos(t),r[e+1]=-Math.sin(t)}this.table=r;for(var n=0,i=1;this.size>i;i<<=1)n++;this._width=n%2==0?n-1:n,this._bitrev=new Array(1<<this._width);for(var o=0;o<this._bitrev.length;o++){this._bitrev[o]=0;for(var u=0;u<this._width;u+=2){var f=this._width-u-2;this._bitrev[o]|=(o>>>u&3)<<f}}this._out=null,this._data=null,this._inv=0}t.exports=r,r.prototype.fromComplexArray=function(t,r){for(var e=r||new Array(t.length>>>1),n=0;n<t.length;n+=2)e[n>>>1]=t[n];return e},r.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var r=0;r<t.length;r++)t[r]=0;return t},r.prototype.toComplexArray=function(t,r){for(var e=r||this.createComplexArray(),n=0;n<e.length;n+=2)e[n]=t[n>>>1],e[n+1]=0;return e},r.prototype.completeSpectrum=function(t){for(var r=this._csize,e=r>>>1,n=2;n<e;n+=2)t[r-n]=t[n],t[r-n+1]=-t[n+1]},r.prototype.transform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null},r.prototype.realTransform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null},r.prototype.inverseTransform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=1,this._transform4();for(var e=0;e<t.length;e++)t[e]/=this.size;this._out=null,this._data=null},r.prototype._transform4=function(){var t,r,e=this._out,n=this._csize,i=1<<this._width,o=n/i<<1,u=this._bitrev;if(4===o)for(t=0,r=0;t<n;t+=o,r++){const e=u[r];this._singleTransform2(t,e,i)}else for(t=0,r=0;t<n;t+=o,r++){const e=u[r];this._singleTransform4(t,e,i)}var f=this._inv?-1:1,s=this.table;for(i>>=2;i>=2;i>>=2){var a=(o=n/i<<1)>>>2;for(t=0;t<n;t+=o)for(var h=t+a,l=t,c=0;l<h;l+=2,c+=i){const t=l,r=t+a,n=r+a,i=n+a,o=e[t],u=e[t+1],h=e[r],p=e[r+1],m=e[n],_=e[n+1],y=e[i],d=e[i+1],v=o,b=u,g=s[c],w=f*s[c+1],A=h*g-p*w,B=h*w+p*g,S=s[2*c],T=f*s[2*c+1],I=m*S-_*T,x=m*T+_*S,j=s[3*c],k=f*s[3*c+1],z=y*j-d*k,M=y*k+d*j,E=v+I,F=b+x,P=v-I,O=b-x,V=A+z,L=B+M,C=f*(A-z),N=f*(B-M),R=E+V,D=F+L,q=E-V,U=F-L,$=P+N,G=O-C,H=P-N,J=O+C;e[t]=R,e[t+1]=D,e[r]=$,e[r+1]=G,e[n]=q,e[n+1]=U,e[i]=H,e[i+1]=J}}},r.prototype._singleTransform2=function(t,r,e){const n=this._out,i=this._data,o=i[r],u=i[r+1],f=i[r+e],s=i[r+e+1],a=o+f,h=u+s,l=o-f,c=u-s;n[t]=a,n[t+1]=h,n[t+2]=l,n[t+3]=c},r.prototype._singleTransform4=function(t,r,e){const n=this._out,i=this._data,o=this._inv?-1:1,u=2*e,f=3*e,s=i[r],a=i[r+1],h=i[r+e],l=i[r+e+1],c=i[r+u],p=i[r+u+1],m=i[r+f],_=i[r+f+1],y=s+c,d=a+p,v=s-c,b=a-p,g=h+m,w=l+_,A=o*(h-m),B=o*(l-_),S=y+g,T=d+w,I=v+B,x=b-A,j=y-g,k=d-w,z=v-B,M=b+A;n[t]=S,n[t+1]=T,n[t+2]=I,n[t+3]=x,n[t+4]=j,n[t+5]=k,n[t+6]=z,n[t+7]=M},r.prototype._realTransform4=function(){var t,r,e=this._out,n=this._csize,i=1<<this._width,o=n/i<<1,u=this._bitrev;if(4===o)for(t=0,r=0;t<n;t+=o,r++){const e=u[r];this._singleRealTransform2(t,e>>>1,i>>>1)}else for(t=0,r=0;t<n;t+=o,r++){const e=u[r];this._singleRealTransform4(t,e>>>1,i>>>1)}var f=this._inv?-1:1,s=this.table;for(i>>=2;i>=2;i>>=2){var a=(o=n/i<<1)>>>1,h=a>>>1,l=h>>>1;for(t=0;t<n;t+=o)for(var c=0,p=0;c<=l;c+=2,p+=i){var m=t+c,_=m+h,y=_+h,d=y+h,v=e[m],b=e[m+1],g=e[_],w=e[_+1],A=e[y],B=e[y+1],S=e[d],T=e[d+1],I=v,x=b,j=s[p],k=f*s[p+1],z=g*j-w*k,M=g*k+w*j,E=s[2*p],F=f*s[2*p+1],P=A*E-B*F,O=A*F+B*E,V=s[3*p],L=f*s[3*p+1],C=S*V-T*L,N=S*L+T*V,R=I+P,D=x+O,q=I-P,U=x-O,$=z+C,G=M+N,H=f*(z-C),J=f*(M-N),K=R+$,Q=D+G,W=q+J,X=U-H;if(e[m]=K,e[m+1]=Q,e[_]=W,e[_+1]=X,0!==c){if(c!==l){var Y=q+-f*J,Z=-f*H-U,tt=R+-f*$,rt=-D- -f*G,et=t+h-c,nt=t+a-c;e[et]=Y,e[et+1]=Z,e[nt]=tt,e[nt+1]=rt}}else{var it=R-$,ot=D-G;e[y]=it,e[y+1]=ot}}}},r.prototype._singleRealTransform2=function(t,r,e){const n=this._out,i=this._data,o=i[r],u=i[r+e],f=o+u,s=o-u;n[t]=f,n[t+1]=0,n[t+2]=s,n[t+3]=0},r.prototype._singleRealTransform4=function(t,r,e){const n=this._out,i=this._data,o=this._inv?-1:1,u=2*e,f=3*e,s=i[r],a=i[r+e],h=i[r+u],l=i[r+f],c=s+h,p=s-h,m=a+l,_=o*(a-l),y=c+m,d=p,v=-_,b=c-m,g=p,w=_;n[t]=y,n[t+1]=0,n[t+2]=d,n[t+3]=v,n[t+4]=b,n[t+5]=0,n[t+6]=g,n[t+7]=w}}},r={};function e(n){var i=r[n];if(void 0!==i)return i.exports;var o=r[n]={exports:{}};return t[n](o,o.exports,e),o.exports}e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{e.r(n),e.d(n,{Autocorrelator:()=>l,PitchDetector:()=>c});var t=e(304);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,r){if(t){if("string"==typeof t)return o(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,r):void 0}}function o(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function u(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function f(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function s(t,r,e){return r&&f(t.prototype,r),e&&f(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,r,e){return(r=h(r))in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function h(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:String(e)}var l=function(){function r(e,n){if(u(this,r),a(this,"_inputLength",void 0),a(this,"_fft",void 0),a(this,"_bufferSupplier",void 0),a(this,"_paddedInputBuffer",void 0),a(this,"_transformBuffer",void 0),a(this,"_inverseBuffer",void 0),e<1)throw new Error("Input length must be at least one");var i;this._inputLength=e,this._fft=new t((i=2*e,i--,i|=i>>1,i|=i>>2,i|=i>>4,i|=i>>8,i|=i>>16,++i)),this._bufferSupplier=n,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}return s(r,[{key:"inputLength",get:function(){return this._inputLength}},{key:"autocorrelate",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._bufferSupplier(t.length);if(t.length!==this._inputLength)throw new Error("Input must have length ".concat(this._inputLength," but had length ").concat(t.length));for(var e=0;e<t.length;e++)this._paddedInputBuffer[e]=t[e];for(var n=t.length;n<this._paddedInputBuffer.length;n++)this._paddedInputBuffer[n]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);for(var i=this._transformBuffer,o=0;o<i.length;o+=2)i[o]=i[o]*i[o]+i[o+1]*i[o+1],i[o+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(var u=0;u<t.length;u++)r[u]=this._inverseBuffer[2*u];return r}}],[{key:"forFloat32Array",value:function(t){return new r(t,(function(t){return new Float32Array(t)}))}},{key:"forFloat64Array",value:function(t){return new r(t,(function(t){return new Float64Array(t)}))}},{key:"forNumberArray",value:function(t){return new r(t,(function(t){return Array(t)}))}}]),r}(),c=function(){function t(r,e){u(this,t),a(this,"_autocorrelator",void 0),a(this,"_nsdfBuffer",void 0),a(this,"_clarityThreshold",.9),a(this,"_minVolumeAbsolute",0),a(this,"_maxInputAmplitude",1),this._autocorrelator=new l(r,e),this._nsdfBuffer=e(r)}return s(t,[{key:"inputLength",get:function(){return this._autocorrelator.inputLength}},{key:"clarityThreshold",set:function(t){if(!Number.isFinite(t)||t<=0||t>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=t}},{key:"minVolumeAbsolute",set:function(t){if(!Number.isFinite(t)||t<0||t>this._maxInputAmplitude)throw new Error("minVolumeAbsolute must be a number in the range [0, ".concat(this._maxInputAmplitude,"]"));this._minVolumeAbsolute=t}},{key:"minVolumeDecibels",set:function(t){if(!Number.isFinite(t)||t>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*Math.pow(10,t/10)}},{key:"maxInputAmplitude",set:function(t){if(!Number.isFinite(t)||t<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=t}},{key:"findPitch",value:function(t,r){var e=this;if(this._belowMinimumVolume(t))return[0,0];this._nsdf(t);var n=function(t){for(var r=[],e=!1,n=-1/0,i=-1,o=1;o<t.length-1;o++)t[o-1]<=0&&t[o]>0?(e=!0,i=o,n=t[o]):t[o-1]>0&&t[o]<=0?(e=!1,-1!==i&&r.push(i)):e&&t[o]>n&&(n=t[o],i=o);return r}(this._nsdfBuffer);if(0===n.length)return[0,0];var u,f,s,a,h,l,c,p,m,_,y,d,v,b=Math.max.apply(Math,function(t){if(Array.isArray(t))return o(t)}(v=n.map((function(t){return e._nsdfBuffer[t]})))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(v)||i(v)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),g=function(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var n,i,o,u,f=[],s=!0,a=!1;try{if(o=(e=e.call(t)).next,0===r){if(Object(e)!==e)return;s=!1}else for(;!(s=(n=o.call(e)).done)&&(f.push(n.value),f.length!==r);s=!0);}catch(t){a=!0,i=t}finally{try{if(!s&&null!=e.return&&(u=e.return(),Object(u)!==u))return}finally{if(a)throw i}}return f}}(t,r)||i(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((a=u=n.find((function(t){return e._nsdfBuffer[t]>=e._clarityThreshold*b})),h=u+1,[d=-(y=-(c=(l=[(f=this._nsdfBuffer)[s=u-1],f[a],f[h]])[0])/2*(a+h)+(p=l[1])*(s+h)-(m=l[2])/2*(s+a))/(2*(_=c/2-p+m/2)),_*d*d+y*d+(c*a*h/2-p*s*h+m*s*a/2)]),2),w=g[0],A=g[1];return[r/w,Math.min(A,1)]}},{key:"_belowMinimumVolume",value:function(t){if(0===this._minVolumeAbsolute)return!1;for(var r=0,e=0;e<t.length;e++)r+=Math.pow(t[e],2);return Math.sqrt(r/t.length)<this._minVolumeAbsolute}},{key:"_nsdf",value:function(t){this._autocorrelator.autocorrelate(t,this._nsdfBuffer);var r,e=2*this._nsdfBuffer[0];for(r=0;r<this._nsdfBuffer.length&&e>0;r++)this._nsdfBuffer[r]=2*this._nsdfBuffer[r]/e,e-=Math.pow(t[r],2)+Math.pow(t[t.length-r-1],2);for(;r<this._nsdfBuffer.length;r++)this._nsdfBuffer[r]=0}}],[{key:"forFloat32Array",value:function(r){return new t(r,(function(t){return new Float32Array(t)}))}},{key:"forFloat64Array",value:function(r){return new t(r,(function(t){return new Float64Array(t)}))}},{key:"forNumberArray",value:function(r){return new t(r,(function(t){return Array(t)}))}}]),t}()})(),n})()));